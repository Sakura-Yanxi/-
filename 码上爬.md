# 码上爬爬虫刷题平台
## 1.动态数据采集
#### 题目很简单，只需要拼接页码参数就可以，防盗链都可以不加
```python
import requests

url = 'https://www.mashangpa.com/api/problem-detail/1/data/?page={}'

headers = {
    'user-agent':'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/138.0.0.0 Safari/537.36 Edg/138.0.0.0',
    'cookie':'Hm_lvt_0d2227abf9548feda3b9cb6fddee26c0=1754540935,1754553617; HMACCOUNT=FA452653B0C48E17; sessionid=4ggoy1g3gv9afiw75ikg54aimt7r8xv5; Hm_lpvt_0d2227abf9548feda3b9cb6fddee26c0=1754553655',
    'referer':'https://www.mashangpa.com/',
}

list = []
for i in range(1,21):
    r = requests.get(url.format(i), headers=headers).json()
    list += r['current_array']
print(list)
print(sum(list))
```
## 2.headers请求头验证
#### 题目很简单，只需要加入防盗链等，拼接页码参数就可以
```python
import requests
url = 'https://www.mashangpa.com/api/problem-detail/2/data/?'
list = []
headers = {
    'cookie':'Hm_lvt_0d2227abf9548feda3b9cb6fddee26c0=1754540935,1754553617; HMACCOUNT=FA452653B0C48E17; sessionid=4ggoy1g3gv9afiw75ikg54aimt7r8xv5; Hm_lpvt_0d2227abf9548feda3b9cb6fddee26c0=1754554890',
    'referer':'https://www.mashangpa.com/problem-detail/2/',
    'user-agent':'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/138.0.0.0 Safari/537.36 Edg/138.0.0.0'
}
for i in range(1,21):
    params = {
        'page': i
    }
    response = requests.get(url, headers=headers,params=params).json()
    list += response['current_array']
print(list)
print(sum(list))
```
## 3.浏览器调试
#### 题目有反扒机制可以通过把浏览器弹窗弹出，或者直接进行本地文件的替换。抓到包之后爬取数据就很简单了。
```python
import requests
url = 'https://www.mashangpa.com/api/problem-detail/3/data/?'

list = []
headers = {
    'cookie':'Hm_lvt_0d2227abf9548feda3b9cb6fddee26c0=1754540935,1754553617; HMACCOUNT=FA452653B0C48E17; sessionid=4ggoy1g3gv9afiw75ikg54aimt7r8xv5; Hm_lpvt_0d2227abf9548feda3b9cb6fddee26c0=1754554890',
    'referer':'https://www.mashangpa.com/problem-detail/2/',
    'user-agent':'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/138.0.0.0 Safari/537.36 Edg/138.0.0.0'
}
for i in range(1,21):
    params = {
        'page': i
    }
    response = requests.get(url, headers=headers,params=params).json()
    list += response['current_array']
print(list)
print(sum(list))
```
## 4.js逆向入门
#### 经过对请求头的观察发现并没有加密，负载中请求参数中有sign和ts的加密，检查调用的堆栈中的loadPage，很容易就发现是md5加密。在控制台中进行检验是否为正常的md5，最后发现为正常的md5加密。最后可以通过python里面的hashlib进行还原。
```python
import hashlib
import requests
import time

url = 'https://www.mashangpa.com/api/problem-detail/4/data/'
headers = {
    'user-agent':'/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/138.0.0.0 Safari/537.36 Edg/138.0.0.0',
    'referer':'https://www.mashangpa.com/problem-detail/4/',
    'cookie':'sessionid=4ggoy1g3gv9afiw75ikg54aimt7r8xv5; Hm_lvt_0d2227abf9548feda3b9cb6fddee26c0=1754557068,1754557358,1754557402,1754557770; HMACCOUNT=FA452653B0C48E17; Hm_lpvt_0d2227abf9548feda3b9cb6fddee26c0=1754557772'
}
list = []
def get_sign(page,_ts):
    string = "tuling" + _ts + str(page)
    sign = hashlib.md5(string.encode('utf-8')).hexdigest()
    return sign
for i in range(1,21):
    _ts = str(int(time.time()) * 1000)
    sign = get_sign(i,_ts)
    params = {
        'page':i,
        'sign':sign,
        '_ts':_ts
    }
    resp = requests.get(url,params=params,headers=headers).json()
    current_array = resp['current_array']
    list +=current_array
print(list)
print(sum(list))
```
## 5.屠龙刀
####  经过对请求头的观察发现并没有加密，负载中请求参数中有xl的加密检查调用的堆栈中的loadPage，很容易就发现是AES加密。
```js
const CryptoJS = require('crypto-js')
const _0x38addf = _0x66a7
function _0x66a7(_0x7461a9, _0x14ffcc) {
    const _0x4f0d09 = _0x4f0d();
    return _0x66a7 = function (_0x66a780, _0x2abc15) {
        _0x66a780 = _0x66a780 - 0xc5;
        let _0x477d8f = _0x4f0d09[_0x66a780];
        return _0x477d8f;
    }, _0x66a7(_0x7461a9, _0x14ffcc);
}
function _0x4f0d() {
    const _0x341c37 = ['2440720SaQcQw', 'jo8j9wGw%6HbxfFn', '9735516pjwmiO', '68862pbatqQ', 'mode', 'AES', '1923264HnviQd', '36906bPsIrd', '12hEJHOd', 'enc', 'pad', 'encrypt', 'Hex', 'Utf8', '689460JbShaf', 'parse', '957060HmuxSn', 'toString', '445UZKyxv'];
    _0x4f0d = function () {
        return _0x341c37;
    };
    return _0x4f0d();
}
let key = CryptoJS.enc.Utf8.parse("jo8j9wGw%6HbxfFn"),
    iv = CryptoJS.enc.Utf8.parse('0123456789ABCDEF');

function encrypt(_0x277028) {
    const _0x4d843e = _0x38addf;
    const jsonStr = JSON.stringify(_0x277028, null, 0).replace(/\s+/g, '')
    let _0x2703a2 = CryptoJS.enc.Utf8.parse(jsonStr),
        _0x50fcf0 = CryptoJS.AES.encrypt(_0x2703a2, key, {
            'mode': CryptoJS.mode.CBC,
            'padding': CryptoJS.pad.Pkcs7,
            'iv': iv
        });
    return(_0x50fcf0['ciphertext']["toString"](CryptoJS.enc.Hex))
    // console.log(_0x50fcf0['ciphertext']["toString"](CryptoJS.enc.Hex)) ;
}
// encrypt({"page":2,"_ts":1759588122496})
```
```python
import execjs
import requests
import json
import time

headers = {
    "origin": "https://www.mashangpa.com",
    "priority": "u=1, i",
    "referer": "https://www.mashangpa.com/problem-detail/5/",
    "user-agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36 Edg/141.0.0.0"
}
with open('1.js','r',encoding='utf-8') as f:
    ctx = execjs.compile(f.read())
cookies = {
    "sessionid": "28xvqtouyogiovqb2hxbujws2rkkrruz",
    "Hm_lvt_0d2227abf9548feda3b9cb6fddee26c0": "1758285094,1758635100,1758681400,1759586129",
    "HMACCOUNT": "FA452653B0C48E17",
    "Hm_lpvt_0d2227abf9548feda3b9cb6fddee26c0": "1759587778"
}
url = "https://www.mashangpa.com/api/problem-detail/5/data/"
list = []
for i in range(1,21):
    params = {
    'page':i,
    '_ts' : int(time.time()*1000)
    }
    data = {
        "xl": ctx.call('encrypt',params),
    }
    data = json.dumps(data, separators=(',', ':'))
    response = requests.post(url, headers=headers, cookies=cookies, data=data).json()
    print(response)
    list += response["current_array"]
    time.sleep(0.5)
print(sum(list))
```
